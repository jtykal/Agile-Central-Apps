<!DOCTYPE html>
<html>
<head>
    <title>Portfolio Item Grid with ProjectPicker</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define('Rally.example.PortfolioItemGridFork', {
  extend: 'Rally.app.App',
  componentCls: 'app',
  launch: function() {

                    this.drawTypeComboBox();
                },

                drawTypeComboBox: function(){

                    this.typeComboBox = this.add({
                        xtype: 'rallyportfolioitemtypecombobox'
                    });

                    this.typeComboBox.on('select', this.drawGrid, this);
                    this.typeComboBox.getStore().on('load', this.drawGrid, this);

                },

                drawGrid: function(){

                    var selectedType = this.typeComboBox.getRecord();

                    Rally.data.ModelFactory.getModel({
                        type: selectedType.get('TypePath'),
                        success: function(model){

                            if(this.grid){
                                this.grid.reconfigureWithModel(model);
                            } else {
                                this.grid = this.add({
                                    xtype: 'rallygrid',
                                    columnCfgs: [
                                        'FormattedID',
                                        'Name',
                                        'Owner',
                                        {
                                            xtype: 'templatecolumn',
                                            text: 'Project',
                                            dataIndex: 'Project',
                                            tpl: Ext.create('Rally.ui.renderer.template.ObjectTemplate', {
                                                extend: 'Ext.XTemplate',
                                                fieldName: 'Project'
                                            }),
                                            field: {
                                              xtype: 'rallyprojectpicker'
                                            }
                                          }
                                    ],
                                    model: model
                                });

                            }

                        },
                        scope: this
                    });

                }
            });


            Rally.launchApp('Rally.example.PortfolioItemGridFork', {
                name:"Portfolio Item Grid with ProjectPicker",
	            parentRepos:""
            });

        });
    </script>



    <style type="text/css">
        .app {
  /* Add app styles here */
}

    </style>
</head>
<body>
</body>
</html>
