<!DOCTYPE html>
<html>
<head>
    <title>Portfolio Item Grid with ProjectPicker</title>

    <script type="text/javascript" src="/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define('Rally.example.PortfolioItemGridFork', {
  extend: 'Rally.app.App',
  componentCls: 'app',
  modelNames: ['PortfolioItem/Epic','PortfolioItem/MasterFeature','PortfolioItem/Feature'],

  launch: function() {
                  Ext.create('Rally.data.wsapi.TreeStoreBuilder').build({
                      models: this.modelNames,
                      autoLoad: true,
                      enableHierarchy: true
                  }).then({
                      success: this._onStoreBuilt,
                      scope: this
                  });
              },

              _onStoreBuilt: function(store) {
                var context = this.getContext();
                  this.add({
                      xtype: 'rallygridboard',
                      context: context,
                      modelNames: this.modelNames,
                      toggleState: 'grid',
                      stateful: false,
                      enableEditing: true,
                      showRowActionsColumn: true,
                      plugins: [
                          'rallygridboardaddnew',
                          {
                                ptype: 'rallygridboardinlinefiltercontrol',
                                inlineFilterButtonConfig: {
                                    stateful: true,
                                    stateId: context.getScopedStateId('filters'),
                                    modelNames: this.modelNames,
                                    inlineFilterPanelConfig: {
                                        quickFilterPanelConfig: {
                                            defaultFields: [
                                                'ArtifactSearch',
                                                'Owner',
                                                'ModelType'
                                            ]
                                        }
                                    }
                                }
                            },
/*                          {
                              ptype: 'rallygridboardfieldpicker',
                              headerPosition: 'left',
                              modelNames: this.modelNames,
                              stateful: true,
                              gridAlwaysSelectedValues: ['Project'],
                              gridFieldBlackList: ['Project'],
                              stateId: context.getScopedStateId('columns-example')
                          },
*/                          {
                                ptype: 'rallygridboardactionsmenu',
                                menuItems: [
                                    {
                                        text: 'Export...',
                                        handler: function() {
                                            window.location = Rally.ui.gridboard.Export.buildCsvExportUrl(
                                                this.down('rallygridboard').getGridOrBoard());
                                        },
                                        scope: this
                                    }
                                ],
                                buttonConfig: {
                                    iconCls: 'icon-export'
                                }
                            }
                      ],
                      gridConfig: {
                          store: store,
                          columnCfgs: [
                              'FormattedID',
                              'Name',
                              'Owner',
                              {
                                  xtype: 'templatecolumn',
                                  text: 'Project',
                                  dataIndex: 'Project',
                                  tpl: Ext.create('Rally.ui.renderer.template.ObjectTemplate', {
                                      extend: 'Ext.XTemplate',
                                      fieldName: 'Project'
                                  }),
                                  field: {
                                    xtype: 'rallyprojectpicker'
                                  }
                                }
                          ]
                      },
                      height: this.getHeight()
                  });
              }
          });


            Rally.launchApp('Rally.example.PortfolioItemGridFork', {
                name:"Portfolio Item Grid with ProjectPicker",
	            parentRepos:""
            });

        });
    </script>



    <style type="text/css">
        .app {
  /* Add app styles here */
}

    </style>
</head>
<body>
</body>
</html>
